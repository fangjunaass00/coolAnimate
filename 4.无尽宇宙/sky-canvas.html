<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Document</title>
</head>
<style>
  * {
    margin: 0;
    padding: 0;
  }

  html,
  body {
    width: 100%;
    height: 100%;
    background: #000;
  }

  #sky {
    position: absolute;
    top: 0;
  }
</style>

<body>
  <canvas class="sky"></canvas>
  <script src="http://alicdn.herdsric.com/herdsric-tool/jquery.min.js"></script>
  <script>
    var canvas = $(".sky")[0];
    var context = canvas.getContext("2d");
    var starCount = 1;
    var pointArr = [];
    var windowInfo = {
      width: window.innerWidth,
      height: window.innerHeight
    };
    var canvasInfo = {
      width: canvas.width,
      height: canvas.height
    }
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvasInfo.width = window.innerWidth;
      canvasInfo.height = window.innerHeight;

    }

    function star() {
      this.speed = 1;
      this.step = 0;
      this.init = function () {
        this.originPx = this.posx = canvasInfo.width / 2 + (50 - 100 * Math.random());
        this.originPy = this.posy = canvasInfo.height / 2 + (50 - 100 * Math.random());

        if (this.originPx > canvasInfo.width / 2) {

        } else {
          // this.speed = -this.speed;
        }
        // this.originPx = 0;
        // this.originPy = 0;



      }
      this.update = function () {

        this.step += 1;
        var disx = this.originPx - canvasInfo.width / 2;
        var disy = this.originPy - canvasInfo.height / 2;

        // var deg = getAngle(this.originPx, this.originPy, canvasInfo.width / 2, canvasInfo.height / 2)
        var deg = Math.atan(disy / disx)
        // var tan = disx / disy;
        console.log(deg)
        if (disy < 0) {
          deg += Math.PI
        }

        this.posx = this.originPx - this.speed * this.step * Math.cos(deg);
        this.posy = this.originPy - this.speed * this.step * Math.sin(deg);


      }
      this.init()
    }
    function createStar(count) {
      for (var i = 0; i < count; i++) {
        var staritem = new star();
        pointArr.push(staritem)
      }



    }

    function renderFrame() {
      context.clearRect(0, 0, context.canvas.width, context.canvas.height);
      var newArr = [];
      requestAnimationFrame(renderFrame);
      pointArr.forEach(function (item) {
        if (item.posx < 0 || item.posx > canvasInfo.width || item.posy < 0 || item.posy > canvasInfo.height) {

        } else {
          item.update()
          context.beginPath();
          context.fillStyle = " rgba(255, 255, 255, 1)";
          context.arc(item.posx, item.posy, 1, 0, Math.PI * 2, false);
          context.fill();
          newArr.push(item);
        }

      });
      context.beginPath();
      context.fillStyle = " rgba(255, 255, 255, 1)";
      context.arc(canvasInfo.width / 2, canvasInfo.height / 2, 10, 0, Math.PI * 2, false);
      context.fill();

      pointArr = newArr;
      if (pointArr.length < starCount) {
        createStar(starCount - pointArr.length)
      }
    }
    function getAngle(px, py, mx, my) {//获得人物中心和鼠标坐标连线，与y轴正半轴之间的夹角
      var x = Math.abs(px - mx);
      var y = Math.abs(py - my);
      var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
      var cos = y / z;
      var radina = Math.acos(cos);//用反三角函数求弧度

      console.log(radina)
      var angle = Math.floor(180 / (Math.PI / radina));//将弧度转换成角度

      if (mx > px && my > py) {//鼠标在第四象限
        angle = 180 - angle;
      }

      if (mx == px && my > py) {//鼠标在y轴负方向上
        angle = 180;
      }

      if (mx > px && my == py) {//鼠标在x轴正方向上
        angle = 90;
      }

      if (mx < px && my > py) {//鼠标在第三象限
        angle = 180 + angle;
      }

      if (mx < px && my == py) {//鼠标在x轴负方向
        angle = 270;
      }

      if (mx < px && my < py) {//鼠标在第二象限
        angle = 360 - angle;
      }


      console.log(angle)
      return angle / 180 * Math.PI;
    }

    $(document).ready(function () {
      resize();
      createStar(starCount);
      renderFrame();

    });
  </script>
</body>

</html>